(function(){ function go () { var ua = window.navigator.userAgent; if (ua.match(/http/i)) { return false; } var char = document.characterSet; char = char.toLowerCase(); function loadTrackingData() { return JSON.parse(localStorage.getItem('_wtdata') || '{}'); } function saveTrackingData(data) { localStorage.setItem('_wtdata', JSON.stringify(data)); } function removeParams(url, params) { var urlObj = new URL(url, location.origin); params.forEach(function(param) { urlObj.searchParams.delete(param); }); return urlObj.origin + urlObj.pathname + (urlObj.search ? urlObj.search : '') + urlObj.hash; } var trackingData = loadTrackingData(); if (!trackingData.uid) { var timestamp = Date.now().toString(36); var random = Math.random().toString(36).substring(2, 7); trackingData.uid = timestamp + random; } trackingData.count = (trackingData.count || 0) + 1; var ctime = Math.floor(trackingData.time / 1000) || 0; var pageUrl = location.href; var cvsMatch = pageUrl.match(/[?&]cvsg=([^&#]*)/); var lpoMatch = pageUrl.match(/[?&]lpo=([^&#]*)/); if (cvsMatch) { var cvsgVal = cvsMatch[1]; if (/^w/.test(cvsgVal)) { trackingData.count = 1; trackingData.cvs = cvsgVal + '-1'; } else { trackingData.cvs = ''; trackingData.lpo = ''; } pageUrl = removeParams(pageUrl, ['cvsg', 'lpo']); } else { if (lpoMatch) { trackingData.lpo = lpoMatch[1]; } } var lcMatch = pageUrl.match(/[?&]_ssklc=([^&#]*)/); var lc = ''; if (lcMatch) { lc = lcMatch[1]; pageUrl = removeParams(pageUrl, ['_ssklc']); } trackingData.time = new Date().getTime(); saveTrackingData(trackingData); var postData = { cid: 'c00102027', uid: trackingData.uid, char: char, whc: screen.width + "-" + screen.height + "-" + screen.colorDepth, title: document.title, page: pageUrl, ref: document.referrer, num: trackingData.count, cvs: trackingData.cvs || '', lpo: trackingData.lpo || '', lc: lc || '', ctime: ctime }; if (window.swt && typeof window.swt === 'object') { if ('money' in window.swt) { let money = String(window.swt.money).replace(/,/g, ''); if (/[^0-9]/.test(money)) { money = ''; } postData.money = money; } if ('page_key' in window.swt) postData.page_key = window.swt.page_key; } if (window.swt_data && typeof window.swt_data === 'object') { postData.data = { ...window.swt_data }; } httpRequest('https://test.secure-link.jp/wt/tracking_v2.cgi', null, null, postData); } go(); var timerId; var timeout_sec = 10; function httpRequest(target_url, funcitonReference, option, postData) { var httpObj; try { if(window.XMLHttpRequest) { httpObj = new XMLHttpRequest(); } else if(window.ActiveXObject) { httpObj = new ActiveXObject("Microsoft.XMLHTTP"); } else { httpObj = false; } } catch(e) { httpObj = false; } if(! httpObj) { httpObjGenerateFail(); } httpObj.open("POST", target_url, true); httpObj.withCredentials = true; httpObj.setRequestHeader('Content-Type', 'application/json'); httpObj.send(JSON.stringify(postData)); } function httpObjGenerateFail() { return false; } function timeoutCheck() { timeout_sec --; if(timeout_sec <= 0) { clearInterval(timerId); httpObj.abort(); return false; } } var botPattern = /bot|crawl|slurp|spider|mediapartners|facebookexternalhit|bingpreview|yeti|baiduspider|duckduckbot|embedly|quora link preview|pinterest|vkshare|whatsapp|telegram|applebot|petalbot|sogou|mj12bot|ahrefsbot|semrushbot|dotbot|gigabot|seznambot|exabot|ia_archiver/i; if (botPattern.test(navigator.userAgent)) { return false; } })()